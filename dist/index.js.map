{"version":3,"file":"index.js","sources":["../src/resize.js","../src/move.js","../src/rotate.js"],"sourcesContent":["/* eslint no-unused-vars: \"warn\" */\n\nimport {\n    add as Vadd,\n    dot as Vdot,\n    lenOf as VlenOf,\n    minus as Vminus,\n    ratioOf as VratioOf,\n    rotate as Vrotate,\n    times as Vtimes,\n} from 'vector-math-fp';\n\nimport { approxFix } from 'approx-fix';\n\n// * ---------------------------------------------------------------- auxiliary data 辅助数据\n\n// * ---------------- supported resize mode 支持的计算类型\n\nconst modeChoice = {\n    normal: 'normal',\n    ratio: 'ratio',\n    mirror: 'mirror',\n    mirrorRatio: 'mirrorRatio',\n};\n\nconst md = modeChoice;\n\n// * ---------------- supported trigger marker 支持的交互触发位置\n\nconst markerChoice = {\n    left: 'left',\n    right: 'right',\n    top: 'top',\n    bottom: 'bottom',\n    leftTop: 'leftTop',\n    leftBottom: 'leftBottom',\n    rightTop: 'rightTop',\n    rightBottom: 'rightBottom',\n};\n\nconst mk = markerChoice;\n\n// * ---------------- error message\n\nconst mapKeyStr = obj =>\n    Object.keys(obj)\n        .map(e => `'${e}'`)\n        .join(' | ');\n\nconst modeChoiceErrMsg = `Invalid 'mode' param, it can only be: ${mapKeyStr(modeChoice)}`;\nconst markerChoiceErrMsg = `Invalid 'marker' param, it can only be: ${mapKeyStr(markerChoice)}`;\n\n// * ---------------- nature of mode 计算模式的性质\n\nconst isRatioModeMap = {\n    [md.normal]: false,\n    [md.ratio]: true,\n    [md.mirror]: false,\n    [md.mirrorRatio]: true,\n};\n\nconst isMirrorModeMap = {\n    [md.normal]: false,\n    [md.ratio]: false,\n    [md.mirror]: true,\n    [md.mirrorRatio]: true,\n};\n\n// * ---------------- trigger from edge, filter input by one axis\n// * 边缘触发时 input的轴向过滤器\n\nconst axisX = [1, 0];\nconst axisY = [0, 1];\nconst inputAxisFilter = {\n    [mk.left]: axisX,\n    [mk.right]: axisX,\n    [mk.top]: axisY,\n    [mk.bottom]: axisY,\n};\n\n// * ---------------- inputToSizeFilter 输入到尺寸的映射\n\nconst inputToSizeFilter = (() => {\n    const l = -1;\n    const r = 1;\n    const t = -1;\n    const b = 1;\n\n    return {\n        [mk.left]: [l, 0],\n        [mk.right]: [r, 0],\n        [mk.top]: [0, t],\n        [mk.bottom]: [0, b],\n        [mk.leftTop]: [l, t],\n        [mk.leftBottom]: [l, b],\n        [mk.rightTop]: [r, t],\n        [mk.rightBottom]: [r, b],\n    };\n})();\n\n// * ---------------- diagonal of size which would be used for corner trigger\n// * 角触发计算所需的对角线向量\n\nconst k1 = r => [r, 1];\nconst k2 = r => [r, -1];\n\nconst ratioCornerOperator = {\n    [mk.leftTop]: k1,\n    [mk.leftBottom]: k2,\n    [mk.rightTop]: k2,\n    [mk.rightBottom]: k1,\n};\n\n// * ---------------- lock ratio operator for edge trigger\n// * 边缘触发时候 尺寸锁定比例的算子\n\nconst rx = (r, [x, y]) => [x, x / r];\nconst ry = (r, [x, y]) => [y * r, y];\nconst ratioEdgeOperator = {\n    [mk.left]: rx,\n    [mk.right]: rx,\n    [mk.top]: ry,\n    [mk.bottom]: ry,\n};\n\n// * ---------------------------------------------------------------- resize API\n\nconst resize = ({ startPos, opts = {} }) => {\n    // * ---------------- preparing\n\n    const { center, size, rotate } = startPos;\n    const { startPoint = [0, 0], movePoint = [0, 0], mode = 'normal', marker = null } = opts;\n    const result = {};\n\n    if (!modeChoice[mode]) {\n        throw modeChoiceErrMsg;\n    }\n    if (!markerChoice[marker]) {\n        throw markerChoiceErrMsg;\n    }\n\n    // * ---------------- pre calculation 静态变量预计算\n\n    // * edge trigger, filter the input, 边缘触发 过滤向量\n    const toAxisVector = inputAxisFilter[marker];\n    const isEdgeMarker = toAxisVector !== undefined;\n\n    // * input would map to size, 输入映射到尺寸 过滤向量\n    const toSizeVector = inputToSizeFilter[marker];\n\n    // * diagonal for corner trigger, 锁定和角触发时所需的 对角线向量\n    const diagonalOperator = ratioCornerOperator[marker];\n\n    // * ratiolocker, 尺寸锁定宽高比的算子\n    const ratioLocker = ratioEdgeOperator[marker];\n\n    // * nature of mode, 模式性质\n    const isRatio = isRatioModeMap[mode];\n    const isMirror = isMirrorModeMap[mode];\n\n    // * ---------------- varibles declaration 过程变量声明\n\n    // * ratio, 宽高比\n    const r = VratioOf(size);\n\n    // * inputDelta, would be processed later, 手势输入值（后续会再次处理）\n    const inputDelta = Vminus(startPoint, movePoint);\n    let delta = Vrotate(-rotate, inputDelta);\n\n    let dSize;\n    let dCenter;\n\n    // * -------------------------------- start calculation 开始计算\n\n    if (!isRatio) {\n        if (isEdgeMarker) {\n            delta = Vtimes(toAxisVector, delta);\n        }\n        dSize = Vtimes(toSizeVector, delta);\n    } else if (isEdgeMarker) {\n        delta = Vtimes(toAxisVector, delta);\n\n        dSize = Vtimes(toSizeVector, delta);\n        dSize = ratioLocker(r, dSize);\n    } else {\n        // * project input to diagonal vector, 将输入映射到对角线投影\n        const diagonalVector = diagonalOperator(r);\n        delta = diagonalVector.map(\n            e => (e * Vdot(diagonalVector, delta)) / VlenOf(diagonalVector) ** 2,\n        );\n\n        dSize = Vtimes(toSizeVector, delta);\n    }\n\n    // * ---------------- calc size\n\n    // * if isMirror, delta size show be twice\n    // * 不中心对称模式 size已经计算好\n    // * 中心对称模式 dSize应该是两倍\n    if (isMirror) {\n        dSize = dSize.map(e => e * 2);\n    }\n\n    // * number should always be positive\n    // * (while drag overhead it will be negative)\n    // * 总是为正数（缩放过头会变成负数）\n    result.size = Vadd(size, dSize)\n        .map(Math.abs)\n        .map(approxFix);\n\n    // * ---------------- calc center\n\n    // * if isMirror, center will never change\n    // * 非中心对称模式 center会变\n    // * 中心对称模式 center不会变\n    if (!isMirror) {\n        result.center = Vadd(center, Vrotate(rotate, Vtimes([0.5, 0.5], delta))).map(approxFix);\n    }\n\n    return result;\n};\n\nexport default resize;\n\nexport { resize, markerChoice, modeChoice };\n","import { add, minus } from 'vector-math-fp';\n\nconst move = ({ startPos, opts = {} }) => {\n    const { startPoint = [0, 0], movePoint = [0, 0] } = opts;\n    const { center } = startPos;\n    const result = {};\n\n    result.center = add(center)(minus(startPoint, movePoint));\n\n    return result;\n};\n\nexport default move;\n","import { angleBetween, minus } from 'vector-math-fp';\n\n// TODO feature 旋转的连续性（角度不要突变） // seognil LC 2019/05/08\n// 需要记录多次计算中的movePoint\n// 计算的范围是 (-179, 180] 拖动时保证（ 179 -> 181、-179 -> -181）\n\nconst rotate = ({ startPos, opts = {} }) => {\n    const { startPoint = [0, 0], movePoint = [0, 0] } = opts;\n    // eslint-disable-next-line no-shadow\n    const { center, rotate } = startPos;\n    const result = {};\n\n    result.rotate = rotate + angleBetween(minus(center, startPoint), minus(center, movePoint));\n\n    return result;\n};\n\nexport default rotate;\n"],"names":["modeChoice","normal","ratio","mirror","mirrorRatio","md","markerChoice","left","right","top","bottom","leftTop","leftBottom","rightTop","rightBottom","mk","mapKeyStr","obj","Object","keys","map","e","join","modeChoiceErrMsg","markerChoiceErrMsg","isRatioModeMap","isMirrorModeMap","axisX","axisY","inputAxisFilter","inputToSizeFilter","l","r","t","b","k1","k2","ratioCornerOperator","rx","x","y","ry","ratioEdgeOperator","resize","startPos","opts","center","size","rotate","startPoint","movePoint","mode","marker","result","toAxisVector","isEdgeMarker","undefined","toSizeVector","diagonalOperator","ratioLocker","isRatio","isMirror","VratioOf","inputDelta","Vminus","delta","Vrotate","dSize","Vtimes","diagonalVector","Vdot","VlenOf","Vadd","Math","abs","approxFix","move","add","minus","angleBetween"],"mappings":"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"}